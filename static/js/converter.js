(function(){const tabs=document.querySelectorAll('.tab');tabs.forEach(t=>t.addEventListener('click',()=>{tabs.forEach(x=>x.classList.remove('active'));t.classList.add('active');document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));const id=t.dataset.tab==='pdf2docx'?'panel-pdf2docx':'panel-docx2pdf';document.getElementById(id)?.classList.add('active');}));const start=document.getElementById('startBtn');if(!start)return;const fi=document.getElementById('fileInput'),bar=document.getElementById('bar'),statusEl=document.getElementById('status'),result=document.getElementById('result');function stream(url){const es=new EventSource(url);es.onmessage=e=>{const data=JSON.parse(e.data);if(data.keepalive)return; if(data.progress!=null){bar.style.width=data.progress+'%'} if(data.message)statusEl.textContent=data.message; if(data.done){es.close(); if(data.error){statusEl.textContent='Erro: '+(data.error||'Falha');return;} if(data.download){result.innerHTML=`<a class='primary' href='${data.download}'>Baixar arquivo</a>`}}};es.onerror=()=>{statusEl.textContent='ConexÃ£o de progresso interrompida.';es.close();}}start.addEventListener('click',async()=>{result.innerHTML='';statusEl.textContent='Enviando arquivo...';bar.style.width='5%';const form=new FormData();const f=fi.files?.[0];if(!f){statusEl.textContent='Escolha um arquivo.';return;}form.append('file',f);const active=document.querySelector('.tab.active')?.dataset.tab||'pdf2docx';let ep=active==='pdf2docx'?'/api/pdf2docx':'/api/docx2pdf';const up=await fetch(ep,{method:'POST',body:form});const r=await up.json();if(!r.ok){statusEl.textContent=r.error||'Erro no upload';return;}stream(r.progress_url);});})();