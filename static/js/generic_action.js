(function(){const start=document.getElementById('startBtn');if(!start)return;const fi=document.getElementById('fileInput'),bar=document.getElementById('bar'),statusEl=document.getElementById('status'),result=document.getElementById('result');const extra=document.getElementById('extraFiles'),ranges=document.getElementById('ranges');function stream(url){const es=new EventSource(url);es.onmessage=e=>{const data=JSON.parse(e.data);if(data.keepalive)return; if(data.progress!=null){bar.style.width=data.progress+'%'} if(data.message)statusEl.textContent=data.message; if(data.done){es.close(); if(data.error){statusEl.textContent='Erro: '+(data.error||'Falha');return;} if(data.download){result.innerHTML=`<a class='primary' href='${data.download}'>Baixar arquivo</a>`}}};es.onerror=()=>{statusEl.textContent='ConexÃ£o de progresso interrompida.';};}start.addEventListener('click',async()=>{result.innerHTML='';statusEl.textContent='Enviando arquivo...';bar.style.width='5%';const f=fi.files?.[0];if(!f){statusEl.textContent='Escolha um arquivo.';return;}const form=new FormData();form.append('file',f);if(extra&&extra.files?.length){for(const ef of extra.files)form.append('extra',ef);}if(ranges){form.append('ranges',ranges.value||'');}const up=await fetch(ACTION,{method:'POST',body:form});const r=await up.json();if(!r.ok){statusEl.textContent=r.error||'Erro no upload';return;}stream(r.progress_url);});})();